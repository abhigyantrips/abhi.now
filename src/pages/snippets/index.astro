---
import PageLayout from "@/layouts/page-layout.astro";
import { render } from "astro:content";
import { getCollection } from "astro:content";

let entries = await getCollection("snippets");
// Sort by publish date descending
entries = entries.sort((a, b) => {
	const dateA = new Date(a.data.date!);
	const dateB = new Date(b.data.date!);
	return dateB.getTime() - dateA.getTime();
});

// Helper function to format date
function formatDate(date: Date | string) {
	const isoString = typeof date === "string" ? date : date.toISOString();
	return isoString.slice(0, 10);
}

// Helper function to extract time
function formatTime(date: Date | string) {
	if (date && typeof date === "object" && "toISOString" in date) {
		return date.toISOString().slice(11, 16);
	}
	if (typeof date === "string") {
		const match = date.match(/T(\d{2}:\d{2})/);
		return match ? match[1] : "";
	}
	return "";
}
---

<PageLayout route="/snippets">
	<div class="h-feed flex flex-col gap-4">
		<span class="p-name hidden">abhigyan trips's sticky notes</span>
		{
			entries.map(async (post: any) => {
				const { Content } = await render(post);
				const dateStr = formatDate(post.data.date);
				const timeStr = formatTime(post.data.date);

				return (
					<div
						id={post.id}
						class="h-entry flex flex-row items-start rounded-lg bg-(--color-text)/10 p-6"
					>
						<div class="flex flex-1 flex-col gap-2">
							<div class="e-content prose prose-strong:text-(--color-text) prose-strong:font-semibold max-w-none text-(--color-text)">
								<Content />
							</div>
							<div class="flex justify-between">
								<time
									class="dt-published pt-2 text-left text-sm text-(--color-text-muted)"
									datetime={post.data.date}
								>
									{dateStr}
									{", "}
									{timeStr}
								</time>
								<a
									class="p-name cursor-pointer px-2 py-1 text-(--color-text-muted) decoration-2 underline-offset-2 hover:underline"
									href={`/snippets/#${post.id}`}
								>
									#{post.data.title || post.id}
								</a>
							</div>
						</div>
					</div>
				);
			})
		}
	</div>
</PageLayout>
