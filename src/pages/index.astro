---
import BaseHead from '@/components/base-head.astro';
import { ROUTES, SITE, SOCIALS } from '@/consts';

import '@/styles/global.css';
---

<html lang='en'>
	<head>
		<BaseHead
			title={SITE.TITLE}
			description={SITE.DESCRIPTION}
		/>
	</head>
	<body class='relative min-h-screen font-serif'>
		<main class='flex min-h-screen flex-col items-center justify-center gap-12 p-4'>
			<!-- Name -->
			<h1 class='font-gummy text-2xl'>abhi {''} <i>bole toh</i> {''} now.</h1>

			<!-- Routes content -->
			<div class='grid grid-cols-2 gap-12 md:grid-cols-4'>
				{
					ROUTES.map((ROUTE) => (
						<a
							href={ROUTE.PATH}
							class='route-link group font-gummy flex flex-col items-center gap-2 text-center decoration-2! underline-offset-2'
							style={`--hover-color: ${ROUTE.COLOR}; --icon-url: url(${ROUTE.ICON});`}
						>
							<span
								class='route-icon size-10 group-hover:scale-110'
								role='img'
								aria-label={ROUTE.NAME}
							/>
							{ROUTE.NAME}
						</a>
					))
				}
			</div>
		</main>
		<footer
			class='absolute right-0 bottom-0 left-0 flex items-center justify-between gap-2 p-8 lg:p-4'
		>
			<div class='hidden lg:block'></div>

			<!-- Social icons -->
			<div class='flex gap-5'>
				{
					SOCIALS.map((SOCIAL) => (
						<a
							href={SOCIAL.HREF}
							class='font-gummy route-link decoration-2! underline-offset-2 hover:underline'
							style={`--hover-color: ${SOCIAL.COLOR};`}
						>
							{SOCIAL.TEXT}
						</a>
					))
				}
			</div>

			<!-- Theme toggle -->
			<button
				id='theme-toggle'
				class='theme-toggle flex size-10 cursor-pointer items-center justify-center rounded-full bg-(--color-text) text-(--color-bg) hover:scale-110'
				aria-label='Toggle Theme'
			>
				<span
					class='sun-icon size-5'
					style='--icon-url: url(/icons/sunny.svg);'
				></span>
				<span
					class='moon-icon size-5'
					style='--icon-url: url(/icons/night.svg);'
				></span>
			</button>
		</footer>
	</body>
</html>

<style>
	@keyframes doodle-wobble {
		0%,
		100% {
			transform: rotate(2deg);
		}
		14% {
			transform: rotate(-5deg);
		}
		28% {
			transform: rotate(4deg);
		}
		42% {
			transform: rotate(-3deg);
		}
		57% {
			transform: rotate(6deg);
		}
		71% {
			transform: rotate(-4deg);
		}
		85% {
			transform: rotate(5deg);
		}
	}

	.font-serif {
		font-family: 'Noto Serif JP', serif;
	}

	.font-gummy {
		font-family: 'Sour Gummy', sans-serif;
		font-optical-sizing: auto;
		font-weight: <weight>;
		font-style: normal;
		font-variation-settings: 'wdth' 400;
	}

	.route-icon {
		display: inline-block;
		background-color: currentColor;
		-webkit-mask-image: var(--icon-url);
		mask-image: var(--icon-url);
		-webkit-mask-size: contain;
		mask-size: contain;
		-webkit-mask-repeat: no-repeat;
		mask-repeat: no-repeat;
		-webkit-mask-position: center;
		mask-position: center;
		transition: background-color 0.1s;
	}

	.group:hover .route-icon {
		animation: doodle-wobble 3.33s steps(1) infinite;
	}

	.route-link:hover {
		color: var(--hover-color);
		text-decoration: underline;
	}

	/* Theme toggle styles */
	.theme-toggle .sun-icon,
	.theme-toggle .moon-icon {
		display: inline-block;
		background-color: currentColor;
		-webkit-mask-image: var(--icon-url);
		mask-image: var(--icon-url);
		-webkit-mask-size: contain;
		mask-size: contain;
		-webkit-mask-repeat: no-repeat;
		mask-repeat: no-repeat;
		-webkit-mask-position: center;
		mask-position: center;
	}
	.theme-toggle .sun-icon {
		display: block;
	}
	.theme-toggle .moon-icon {
		display: none;
	}
	:global(.dark) .theme-toggle .sun-icon {
		display: none;
	}
	:global(.dark) .theme-toggle .moon-icon {
		display: block;
	}
</style>

<script>
	const toggle = document.getElementById('theme-toggle');

	const getThemePreference = () => {
		if (typeof localStorage !== 'undefined' && localStorage.getItem('theme')) {
			return localStorage.getItem('theme');
		}
		return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
	};

	const updateTheme = () => {
		const isDark = getThemePreference() === 'dark';
		document.documentElement.classList.toggle('dark', isDark);
	};

	toggle?.addEventListener('click', () => {
		const isDark = document.documentElement.classList.contains('dark');
		const newTheme = isDark ? 'light' : 'dark';
		localStorage.setItem('theme', newTheme);
		document.documentElement.classList.toggle('dark', !isDark);
	});

	// Listen for system preference changes
	window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
		if (!localStorage.getItem('theme')) {
			document.documentElement.classList.toggle('dark', e.matches);
		}
	});

	// Handle View Transitions (Astro)
	document.addEventListener('astro:after-swap', updateTheme);
</script>
